{% extends "base.html" %}

{% load static %}
{% block title %} <title> Mamase | Visualization </title> {% endblock title %}
{% block css %} 
<link rel="stylesheet" type="text/css" href="{% static 'css/c3.css' %}"> 
<link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css">
{% endblock css %}
{% block js%} 
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="{% static 'js/c3.js' %}"></script>
<script src="http://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
<script>

var daily = []
var monthly = []
var raw=[]
//defining control variables
var weather_station= "Mulot Weather"
var weather_variable="Rain"
var time_interval = "monthly"
var month = "Jan"
var year = 2015

$.ajax({
	type: 'GET',
	url : "/mamase/api/all/",
	dataType: "json",
	success: function(data) {
		daily = data.daily
		monthly = data.monthly

		//Default to daily average data for now
		dav = daily.average
		console.log(dav);

		created = ["created"]
		field1 = ["Field1"]
		field2 = []
		field3 = []
		field4 = []
		field5 = []
		field6 = []
		field7 = []
		field8 = []

		for (var j = 0; j < dav.length; j++) {
			created.push(dav[j].added);
			field1.push(dav[j].field1__avg);
		}

        var charting = c3.generate({
                 		bindto: '#charting',
                 		data: {
                 			x: 'created',
                 			xFormat: '%Y-%m-%d %H:%M:%S',
                 			columns: [created,field1], 
                 		},
                 		axis: {
                 			x: {
                 				type: 'timeseries',
                 				tick: {
                 					format: '%Y-%m-%d %H:%M'
                 				}
                 			}
                 		}
                 	});
              
		}
	});

	var monthly_data =  [
	[ "Mulot", 25,37, 32, 31, 37, 21, 22, 23, 33, 34, 23, 26,],
	[ "Kerook", 33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 37,],
	[ "Govener's Camp",  21, 31, 22, 26, 25, 37, 23, 33, 34, 23, 32,37,],
	[ "Mara Conservancy", 21, 22, 23, 33, 34, 23, 26, 25, 37, 32, 31, 37, ],
	[ "Bomet", 25, 37, 32, 31, 37, 21, 22, 23, 33, 34, 23, 26,],
	[ "Narotia", 25, 37, 32, 31, 37, 21, 22, 23, 33, 34, 23, 26,],
	[ "Rekaro", 25, 37, 32, 31, 37, 21, 22, 23, 33, 34, 23, 26,],
	[ "Talek", 25, 37,  32, 31, 37, 21, 22, 23, 33, 34,  23, 26,],
	[ "Mara River", 21, 23, 33, 34, 37, 32, 31, 37, 21, 22, 23, 26,],
	];
	var daily_data=[
	[ "Mulot", 2,7, 12, 3, 7, 11, 20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 37, 3, 6,31, 37, 21, 22, 23, 33,7, 6],
	[ "Kerook", 33, 34, 23, 26, 21, 11, 20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 37, 3, 6,31, 37, 21, 22, 23, 33, 7, 6],
	[ "Govener's Camp",  21, 31, 22, 26, 25, 37,33, 34, 23, 26, 21, 11, 20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 37, 3, 6,31, 37],
	[ "Mara Conservancy", 21, 22, 23, 33,21, 31, 22, 26, 25, 37,33, 34, 23, 26, 21, 11, 20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 37, 34, 23, 26, 25],
	[ "Bomet", 25, 37, 32, 31, 37,21, 22, 23, 33,21, 31, 22, 26, 25, 37,33,20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 21, 22, 23, 33, 34, 23, 26],
	[ "Narotia", 25, 37, 32, 31, 21, 22, 23, 33,21, 31, 22, 26, 25, 37,33, 34, 23, 26, 21, 11, 20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 34, 23, 26],
	[ "Rekaro", 21, 22, 23, 33,21, 31, 22, 26, 25, 37,33, 34, 23, 26, 21, 11, 20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 21, 22, 23, 33, 34, 23, 26],
	[ "Talek", 25, 37,  32, 31, 37, 21, 2,7, 12, 3, 7, 11, 20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 37, 3, 6,31, 37, 21, 26],
	[ "Mara River", 21, 2,7, 12, 3, 7, 11, 20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 37, 3, 6,31, 37, 21,0, 37, 21, 22, 23, 26],
	];
	var raw_data=[
	["Mara Conservancy", 21, 22, 23, 33,21, 31, 22, 26, 25, 37,33, 34, 23, 26, 21, 11, 20, 2,33, 34, 23, 26, 21, 22, 23, 25, 37, 32, 31, 37, 34, 23, 26, 25],
	];
	var time1=['station',1,	2,	3,	4,	5,	6,	7,	8,	9,	10,	11,	12,	13,	14,	15,	16,	17,	18,	19,	20,	21,	22,	23,	24,	25,	26,	27,	28,	29,	30]
	var xaxis = ['station','Jan','Feb','Mar','Apr','May','June','Jul','Aug','Sep','Oct','Nov','Dec'];   

	dataset=monthly_data


		//change station
		function selectStation(interval) {
			var station = interval.value;
			console.log("selected station is "+station )
		}

    	//change weather variable
    	function weatherVariable(interval) {
    		var weather = interval.value;
    		console.log("selected weather station is "+weather )
    	}

    	//change month
    	function selMonth(interval) {
    		var month = interval.value;
    		console.log("selected month is "+month )
    	}

    //change year
    function selYear(interval) {
    	var year = interval.value;
    	console.log("selected year is "+year )
    }


    function timeInterval(interval) {
    	var value = interval.value;
    	if (value=="monthly") {
    		dataset=monthly_data
    		x_data=xaxis 
      //console.log("Monthly "+dataset)
  }
  else if (value=="daily") {
  	dataset=daily_data
  	x_data=time1
     // console.log("Daily "+dataset)

 }
 else if (value=="raw data") {dataset =raw_data,
 	xdata=time1
    //console.log("raw Data :"+dataset)
}


dataset.push(x_data)

var chart = c3.generate({
	bindto: '#charter',
	data: {
		x: 'station',
		columns: dataset,
	},
	tooltip: {
        	grouped: false //one graph at a time
        },
        axis: {
        	x: {
        	    type: 'category' // This is needed if your X axis is not NaN attributes
        	}
        }
    });
}




$(document).ready(function(){
	var asInitVals = new Array();
	var year//for changing year
var month//for changing month
var station="Mulot"//for changing station
var weather="temperature"//for weather
var oTable = $('#charttable').DataTable( {
	dom: 'Bfrtip',
	buttons: [
	{
		extend: 'csvHtml5',
	}
	],
	data: dataset,
	columns: [
	{ title: "Station Name"},
	{ title: "Jan"},
	{ title: "Feb"},
	{ title: "Mar"},
	{ title: "Apr"},
	{ title: "May"},
	{ title: "Jun"},
	{ title: "Jul"},
	{ title: "Aug"},
	{ title: "Sep"},
	{ title: "Oct"},
	{ title: "Nov"},
	{ title: "Dec"}
	],
});
var xaxis = ['station','Jan','Feb','Mar','Apr','May','June','Jul','Aug','Sep','Oct','Nov','Dec']    
dataset.push(xaxis);

//draw daily and raw
function drawGraph1(dataset){
var chart = c3.generate({
	bindto: '#charter',
	data: {
		x: 'station',
		columns: dataset,
	},
	tooltip: {
        	grouped: false //one graph at a time
        },
        axis: {
        	x: {
        	    type: 'category' // This is needed if your X axis is not NaN attributes
        	}
        }
    });
}
//draw monthly data
function drawGraph2(dataset){
var chart = c3.generate({
	bindto: '#charter',
	data: {
		x: 'station',
		columns: dataset,
	},
	tooltip: {
        	grouped: false //one graph at a time
        },
        axis: {
        	x: {
        	    type: 'category' // This is needed if your X axis is not NaN attributes
        	}
        }
    });
}

});
// export only what is visible right now (filters & paginationapplied)
$('#export_visible').click(function(event) {
	event.preventDefault();
	table2csv(oTable, 'visible', 'table.display');
})

// export all table data
$('#export_all').click(function(event) {
	event.preventDefault();
	table2csv(oTable, 'full', 'table.display');
})
</script>
<script>
	function table2csv(oTable, exportmode, tableElm) {
		var csv = '';
		var headers = [];
		var rows = [];

        // Get header names
        $(tableElm+' thead').find('th').each(function() {
        	var $th = $(this);
        	var text = $th.text();
        	var header = '"' + text + '"';
            // headers.push(header); // original code
            if(text != "") headers.push(header); // actually datatables seems to copy my original headers so there ist an amount of TH cells which are empty
        });
        csv += headers.join(',') + "\n";

        // get table data
        if (exportmode == "full") { // total data
        	var total = oTable.fnSettings().fnRecordsTotal()
        	for(i = 0; i < total; i++) {
        		var row = oTable.fnGetData(i);
        		row = strip_tags(row);
        		rows.push(row);
        	}
        } else { // visible rows only
        	$(tableElm+' tbody tr:visible').each(function(index) {
        		var row = oTable.fnGetData(this);
        		row = strip_tags(row);
        		rows.push(row);
        	})
        }
        csv += rows.join("\n");

        // if a csv div is already open, delete it
        if($('.csv-data').length) $('.csv-data').remove();
        // open a div with a download link
        $('body').append('<div class="csv-data"><form enctype="multipart/form-data" method="post" action="/csv.php"><textarea class="form" name="csv">'+csv+'</textarea><input type="submit" class="submit" value="Download as file" /></form></div>');

    }

    function strip_tags(html) {
    	var tmp = document.createElement("div");
    	tmp.innerHTML = html;
    	return tmp.textContent||tmp.innerText;
    }

</script>
{% endblock js %}

{% block body_class %}visual-index{% endblock %}

{% block content %}

<!-- Container -->
<div id="container">  
	<!-- Start Chart Section -->
	<div class="pricing-section" style="padding-top:60px; padding-bottom:60px;">
		<div class="container">
			<div class="row">
				<div class="col-md-12">

					<!-- Text -->
					<p class="text-center" style="margin-bottom:20px;">Low cost stations in the Mara River Basin collect real time data. Here the open access data can be viewed. Click one of the channels to view data of your interest.</p>

					<div class="big-title text-center fadeInDown">
						<h1>Monthly <strong> View</strong></h1>
					</div>
				</div>
			</div>

			<div class="row pricing-tables">
				<div class="col-md-4 col-sm-4">
					<div class="dropdown">
						<p> Select Display Mode: 
							<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
								Weather Station
								<span class="caret"></span>
							</button>
							<ul class="dropdown-menu" aria-labelledby="dropdownMenu1" id="channel-lis">
								<li><a href="#">Action</a></li>
							</ul>
						</p>
					</div>	    
					<div style="margin-top:20px;">
						<iframe src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d255282.1616275287!2d36.84739685!3d-1.30480355!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2ske!4v1442993224780" width="400" height="400" frameborder="0" style="border:0" allowfullscreen></iframe>
					</div>
				</div>		
				<div class="col-md-8 col-sm-8">
					<div class="col-md-12">
						<div id="charting"></div>
					</div>
					<div class="col-md-12">
						<div id="controls">
							<table  class='table borderless'>
								<thead>
									<tr>
										<td>
											Weather Station
										</td>
										<td>
											Weather Variable
										</td>
										<td>
											Time Interval
										</td>
										<td>
											Month
										</td>
										<td>
											Year
										</td>
										<td>
										</td>	
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>
											<div class="dropdown">
												<!--<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">-->

												<select id="selectstation" onchange="selectStation(this)"
												<option id="">Station</option>
												<option id="Mulot Weather">Mulot Weather</option>
												<option id="Nairotia Weather">Nairotia Weather</option>
												<option id="Mara Conservancy Weather">Mara Conservancy Weather</option>
											</select> 



										</ul>
									</div>
								</td>
								<td>
									<div class="dropdown">
												<!--<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
													Rainfall
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu" aria-labelledby="dropdownMenu1" id="channel-list">
													<li><a href="#">Temperature</a></li>
													<li><a href="#">Pressure</a></li>-->
													<select id="weathervariables" onchange="weatherVariable(this)">

														<option value="Rain">Rain</option>
														<option value="Barometric Pressure">Barometric Pressure</option>
														<option value="Air Temperature">Air Temperature</option>
														<option value="Wind Direction">Wind Direction</option>
														<option value="Wind Direction">Wind Direction</option>
													</select> 


												</div>
											</td>	
											<td>
												<div class="dropdown">
												<!--<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
													Interval
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu" aria-labelledby="dropdownMenu1" id="channel-list" onchange="timeInterval(this)">
													<li><a value="weekly" href="#">Weekly</a></li>
													<li><a value="monthly" href="#">Monthly</a></li>
													<li><a value="raw" href="#">Raw Data</a></li>-->


													<select id="timeinterval" onchange="timeInterval(this)">
														<option value="daily">Daily</option>
														<option value="monthly">Monthly</option>
														<option value="raw data">Raw Data</option>
													</select> 

												</div>
											</td>
											<td>
												<div class="dropdown">
												<!--<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
													Month
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu" aria-labelledby="dropdownMenu1" id="channel-list">

													<li><a href="#">Jan</a></li>
													<li><a href="#">Feb</a></li>
													<li><a href="#">Mar</a></li>
													<li><a href="#">Apr</a></li>
													<li><a href="#">May</a></li>
													<li><a href="#">Jun</a></li>
													<li><a href="#">Jul</a></li>
													<li><a href="#">Aug</a></li>
													<li><a href="#">Sep</a></li>
													<li><a href="#">Oct</a></li>
													<li><a href="#">Nov</a></li>
													<li><a href="#">Dec</a></li>
												</ul>-->
												<select id="month" onchange="selMonth(this)">		
													<option value="jan">Jan</option>
													<option value="feb">Feb</option>
													<option value="mar">Mar</option>
													<option value="apr">Apr</option>
													<option value="may">May</option>
													<option value="jun">Jun</option>
													<option value="jul">Jul</option>
													<option value="aug">Aug</option>
													<option value="sep">Sep</option>
													<option value="oct">Oct</option>
													<option value="nov">Nov</option>
													<option value="dec">Dec</option>
												</select> 
											</div>
										</td>
										<td>
											<div class="dropdown">
												<!--<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
													Year
													<span class="caret"></span>
												</button>
												<ul class="dropdown-menu" aria-labelledby="dropdownMenu1" id="channel-list">
													<li><a href="#">2015</a></li>
													<li><a href="#">2014</a></li>
												</ul>-->
												<select id="year" onchange="selYear(this)">			
													<option value="2014">2014</option>
													<option value="2015">2015</option>
													<option value="2016">2016</option>
												</select> 
											</div>
										</td>
										<!--<td>
											<button type="button" class="btn btn-default">Generate CSV <i class="fa fa-download"></i></button>		      
										</td>-->
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div class="col-md-12">
						<table id="charttable" class="table table-striped table-bordered compact" cellspacing="0" width="100%" style="margin-top: 20px;">
						</table>
					</div>
				</div>		
			</div>		

		</div>
	</div>
	<!-- End Chart Section -->


</div>
<!-- End Container -->
{% endblock content %}

{% block partners %}{% endblock  %}
